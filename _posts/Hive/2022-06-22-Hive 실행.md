---
title: "Hive 실행"
# header:
#   image: /assets/images/hadoop/hadoop_logo.svg
#   caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
layout: posts
categories:
  - Hive
tags:
  - Hadoop
  - Hive
toc: true
toc_sticky: true

date: 2022-06-22
last_modified_at: 2022-06-22
---

<br>

# 하이브 설정하기

하이브는 하둡과 같이 XML 설정 파일을 사용하여 환경 설정을 한다. 관련 파일은 hive-site.xml 이고 하이브의 conf 디렉터리에 위치한다. 이 파일은 사용자가 하이브를 실행할 때마다 필요한 속성을 설정할 수 있다. 같은 디렉터리에 하이브가 보유하고 있는 속성과 기본값을 기록한 hive-default.xml 파일도 있다.

사용자는 hive 명령어에 --config 옵션을 추가하여 하이브가 hive-site.xml 파일을 찾는 설정 디렉터리를 재정의할 수 있다.

```bash
hive --config /Users/tom/dev/hive-conf
```

이 옵션은 hive-site.xml 파일 자체가 아니라 그것을 포함하고 있는 디렉터리를 지정한다는 사실에 주의하라. 이러한 방식은 여러 개의 클러스터를 위한 각 사이트 파일을 규칙적으로 전환하려 할 때 유용하다. HIVE_CONF_DIR 환경변수에 설정 디렉터리를 지정해도 동일한 효과가 있다.

hive-site.xml 은 클러스터 연결을 위한 세부사항을 정의한 파일이다. 사용자는 일반적인 하둡 속성인 fs.defaultFS 와 yarn.resourcemanager.address에 파일시스템과 자원 관리자를 각각 지정할 수 있다. 별다른 설정을 하지 않으면 기본적으로 로컬 파일시스템과 로컬 프로세스 잡 실행자가 지정되는데, 이것은 작은 실습 데이터셋으로 하이브를 실행하기에 좋은 방법이다. 또한 메타스토어에 대한 환경 설정도 hive-site.xml에 있다.

> 만일 하둡 클러스터 하나를 여러 명의 사용자가 공유해야 한다면 모든 사용자가 파일을 쓸 수 있는 디렉터리를 만들어야 한다. 아래 일련의 명령은 디렉터리를 생성하고 적절한 권한을 부여하는 예제다.

<br>

```bash
hadoop fs -mkdir /tmp
hadoop fs -chmod a+w /tmp
hadoop fs -mkdir /user/hive/warehouse
hadoop fs -chmod a+w /user/hive/warehouse
```

hive 명령과 함께 -hiveconf 옵션을 사용하면 세션 기반의 속성을 설정할 수 있다. 예를 들어 다음 명령어는 세션이 지속되는 동안만 클러스터를 의사 분산 클러스터를 설정한다.

```bash
hive -hiveconf fs.defaultFS=hdfs://localhost \
-hiveconf mapreduce.framework.name=yarn \
-hiveconf yarn.resourcemanager.address=localhost:832
```

또한 사용자는 하나의 세션 내에서 SET 명령어를 사용하여 환경 설정을 변경할 수 있다. 특정 쿼리에 대해 하이브 설정을 변경하는 방식은 매우 유용하다. 예를 들어 다음 명령은 테이블 정의에 따라 버킷의 사용을 보장한다.

```
hive > SET hive.enforce.bucketing=true;
```

어떤 속성이든 현재 값을 보고 싶으면 SET 다음에 속성 이름을 입력하면 된다.

```
hive > SET hive.enforce.bucketing;
hive.enforce.bucketing=true
```

SET은 하이브에 설정된 모든 속성과 그 값을 출력할 것이다. 이 때 이 절에서 다룬 방식으로 기본 설정된 속성을 재정의하지 않았다면 기본 속성이 출력되지 않는다는 점을 기억하라. 하둡 기본 값을 포함한 시스템의 모든 속성을 출력하려면 SET -v를 사용하라.

속성을 설정할 때는 우선순위가 존재한다. 다음 목록에서 낮은 숫자가 높은 숫자보다 우선순위가 높다.

1. 하이브 SET 명령어
2. 명령행 -hiveconf 옵션
3. hive-site.xml과 하둡 site 파일(core-site.xml, hdfs-site.xml, mapred-site.xml, yarn-site.xml)
4. 하이브 기본 파일과 하둡 기본 파일(core-default.xml, hdfs-default.xml, mapred-default.xml, yarn-default.xml)

<br><br>

# 실행 엔진

하이브는 원래 실행 엔진으로 맵리듀스를 사용하도록 작성되었고, 여전히 기본 엔진은 맵리듀스다. 실행 엔진으로 아파치 테즈(Apache Tez)를 사용해서 하이브를 실행할 수 있으며, 스파크를 지원하는 작업도 현재 진행되고 있다. Tez와 Spark는 맵리듀스보다 더 높은 성능과 유연성을 제공하는 범용 방향성 비순환 그래프(directed acyclic graph | DAG) 엔진이다. 예를 들면 잡의 임시 출력을 HDFS에 저장하는 맵리듀스와 달리 테즈와 스파크는 임시 출력을 로컬 디스크에 기록하건 하이브 플래너의 요청으로 메모리에 저장하는 방식으로 복제 오버헤드를 피할 수 있다.