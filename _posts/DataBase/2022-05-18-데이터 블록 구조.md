---
title: "데이터 블록 구조"
toc: true
#header:
  #image: /assets/images/spark/spark_logo.svg
  #caption: "Photo credit: [**Wikipedia**](https://upload.wikimedia.org/wikipedia/commons/f/f3/Apache_Spark_logo.svg)"
layout: posts
categories:
  - DataBase
tags:
  - DataBase
toc: true
toc_sticky: true

date: 2022-05-18
last_modified_at: 2022-05-18
---

<br>

# Tablespace

<br>

테이블 스페이스는 데이터베이스의 논리적 저장 구조 중 가장 포괄적이고 넓은 범위를 가진 형태로서 실제 테이터 베이스 각각의 물리적 파일들은 이 테이블스페이스에 N:1 형태로 연결되어 있다.

<br>
<div align='center'>
<img src='https://user-images.githubusercontent.com/45858414/169022817-898fdbf1-9e6f-4e85-999e-37c3bc534772.png' width='70%' height='70%' />
</div>

<br>

[ Tablespace ]

1. 논리적으로 서로 관련된 데이터가 저장된 파일들을 묶어놓은 단위
2. 물리적인 파일(실제파일)과 논리적인 저장단위를 서로 분리시키는 역할
3. 데이터 파일 경로와 무관

DataFile 의 User01.dbf 와 User02.dbf는 각각 서로 다른 경로에 두 개의 파일로 나뉘어져 있지만 논리적으로는 서로 관련된 데이터를 가지는 하나나의 테이블스페이스에 속해 있으며, 추가로 더 나누거나 하나로 합쳐서 관리할 수도 있다. 즉, 논리적 저장 구조와 실제 저장되는 경로나 파일이름 등의 물리적 저장 구조는 서로 영향을 미치지 않는다.

<br><br>

# Segment

<br>

데이터베이스를 사용할 때 가장 많이 접근하게 되는 것은 테이블이며, 각각의 테이블들은 Segment에 해당한다. 세그먼트에는 Data, Index, Temporary, Undo 같은 종류들로 나뉘는데, 물론 Data Segment가 가장 일반적으로 사용되는 형태이다.
Temporary Segment는 특정 SQL문이나 대용량 SQL 문의 실행을 위해 임시 작업 영역이 필요할 때 생성되었다가 끝나면 사라지는 형태로, 사용자가 지정할 수도 있고 시스템 기본값을 사용할 수도 있다. Undo Segment는 변경되기 전 데이터를 기록해두었다가 롤백될 때 되돌리는 역할을 한다.

<br>

<div align='center'>
<img src='https://user-images.githubusercontent.com/45858414/169024087-5ffcd1bb-20ff-43da-ae68-818dcfdc9521.png' width='70%' height='70%' />
</div>

<br>

[ Segment ]

1. 테이블스페이스 내의 특정 유형의 논리적 저장구조로 할당된 영역
2. 테이블, 인덱스 등의 오브젝트가 세그먼트에 포함
3. 저장 공간을 가지는 오브젝트만을 세그먼트라고 함 (<> View, Sequence, Synonym)

<br>

표로 만들어진 부분의 전체 공간을 테이블스페이스라고 할 때, 색이 칠해진 부분은 Segment가 차지하고 있는 공간영역이라고 생각하면 된다. 주의할 것은 세그먼트는 실제 데이터 저장 공간을 가지는 오브젝트만을 지칭하는 것으로 View, Sequence, Synonym 등은 해당되지 않는다. 이들은 시스템 테이블스페이스에 정의만 저장된다. Segment의 구성 요소 중 HWM(Wigh Water Mark, 고수위) 가 있다.

<br><br>

# Extent

<br>

Extent는 하나 이상의 연속된 데이터 블록의 모임이며, 세그먼트에 대한 공간 할당 단위이기도 하다. 그리고 위에서 테이블 스페이스는 여러 개의 물리적 파일로 이루어진다고 하였는데 Extent는 반드시 하나의 데이터 파일에만 존재할 수 있다.

<br>

<div align='center'>
<img src='https://user-images.githubusercontent.com/45858414/169025427-96d88011-694f-4dfc-a158-326d2605ef71.png' width='70%' height='70%' />
</div>

<br>

[ Extent ]

1. 하나 이상의 연속된 데이터 블록의 모임
2. 세그먼트에 공간을 할당하는 단위
3. 하나의 데이터 파일에만 존재

<br>

Extent가 Segment의 공간 할당 단위라고 했는데, 데이터가 추가되었을 때 Segment에 저장공간이 없을 경우 시스템 기본값 또는 지정한 크기만큼의 새로운 Extent 영역을 할당해주게 된다.
위 이미지 안의 표에서 진하게 표시된 부분은 하나의 Segment가 각각의 Extent로 이루어져 있음을 보여주기 위함이고, 중간 정도의 색은 기본 Segment의 영역, 가장 연하게 표시된 부분은 기존 Segment에 더 이상 저장공간이 없어 새롭게 Extent가 추가되었음을 나타내고 있다.
Extent는 Segment의 생성이나 확장, 수동 Extent 할당 등의 경우에 새로운 Extent가 할당되고, Segment가 삭제되거나 Truncate 명령을 실행했을 때, 또는 수동 해제 시 할당 해제된다.

<br><br>

# Block

<br>

Block은 오라클의 기본 I/O 단위로서 모든 데이터는 Block으로 이루어져 있다. 기본 I/O 단위라는 말이 중요한데, DB에서 데이터를 검색할 때 아주 작은 데이터 하나만을 찾으려고 할 때도 최소한 하나의 Block에 저장된 전체 데이터에 대해서는 스캔이 이루어진다는 뜻이다.
운영체제에 따라 블록 크기의 시스템 기본설정이 다르며 64bit 운영체제에서는 보통 8KB가 기본 값이다. 그리고 이 값은 모든 데이터 저장의 기본값이 되므로 처은 특정 값으로 설정했다면 데이터베이스를 변경하지 않는 이상 중간에는 수정할 수 없다.

<br>
<div align='center'>
<img src='https://user-images.githubusercontent.com/45858414/169027265-bb357511-aca3-4313-a6dd-71a35f403005.png' height='70%' weight='70%' />
</div>
<br>

[ Data Block ]

1. 블록크기는 최소 2KB, 최대 64KB (32bit 운영체제는 기본 4kb)
2. DB_BLOCK_SIZE 로 설정하며 DB 생성 시 설정 (한 번 지정 후 변경 불가)
3. Top-Down 방식으로 헤더 정보가 증가되고, Bottom-Top 방식으로 데이터 증가

<br>

위 이미지 안의 표에서, 위에서 다룬 Extent를 더 잘게 쪼개어 표현하고 있는데 모든 데이터는 블록으로 이루어져있음을 나타낸 것이고, 수평 화살표는 데이터가 쌓여가는 방향 및 풀스캔이 이루어질 때 진행하는 방향, 그리고 index라고 표시된 수직화살표는 인덱스로서 데이터 검색 시 블록을 찾아 접근함을 보여주고 있다.

<br>

데이터 블록 안에서는 아래 이미지와 같이 헤더 정보와 데이터 정보가 저장된다.

<div align='center'>
<img src='https://user-images.githubusercontent.com/45858414/169029227-a45e533a-94d9-43af-a274-d2d43e24c116.png' height='70%' weight='70%' />
</div>

<br><br>